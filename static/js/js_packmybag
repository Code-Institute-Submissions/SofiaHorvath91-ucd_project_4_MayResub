/* DOM elements */
let bagweight = document.getElementById("bagweight");
let additems_current_bagweight = document.getElementById("additems_bag_weight");
let additems_max_bagweight = document.getElementById("additems_max_bag_weight");
let additems_new_bagweight = document.getElementById("additems_new_bag_weight");

/* Variables */

let max_bagweight;
let current_bagweight = 0.00;
let items_additems;
let items_detailsitems;

$(function () {
    if(window.location.pathname.includes('mybag_add_items')){
        items_additems = add_items_JSON;
        max_bagweight = parseFloat(additems_max_bagweight.value).toFixed(2);
        additems_current_bagweight.innerHTML = current_bagweight.toFixed(2) + " kg";
    }
   if(window.location.pathname.includes('mybag_details')){
        items_detailsitems = details_items_JSON;
    }
});

/* Calculate weight of bag automatically based on the weight of user (20% + 1kg) */
$(document).on('input', '#userweight', function(){
    userweight = $("#userweight").val();
    bagweight_kg = Math.round(userweight) * 0.2 + 1;
    bagweight.value = bagweight_kg.toFixed(2);
})

$(".item_checkbox").change(function() {
    id = this.id;
    item = items_additems.find(x => x.name === id);

    if($(this).prop('checked')) {
        if(item.external == false){
            current_bagweight += parseFloat(item.weight);

            if(current_bagweight > max_bagweight){
                alert("You cannot put more items in the bag, remove items before packing new ones.");
                this.prop('checked', false);
            }
            else{
                set_dom_current_bag_weight();
                additems_new_bagweight.value = current_bagweight;
            }
        }
    } else {
        if(item.external == false){
            current_bagweight -= parseFloat(item.weight);
        }
        set_dom_current_bag_weight();
        additems_new_bagweight.value = current_bagweight;
    }
});

/* Handle click on information sign / item name to show item details (mybag_add_items / mybag_details)
=> Source / Inspiration : https://www.w3schools.com/howto/howto_css_modal_images.asp */
$('.info-item').click(function () {
    id = this.id;
    id_name = id.split("-");
    name = id.split("-")[0];

    if(id_name.includes("additems")){
        item = items_additems.find(x => x.name === name);
        set_modal_dom_elements_items(item, "additems");
    } else{
        item = items_detailsitems.find(x => x.name === name);
        set_modal_dom_elements_items(item, "detailsitems");
    }
});

/* Handle click on close icon to close modal (mybag_add_items)*/
$('#additems-close-modal').click(function () {
    document.getElementById("additems-modal").style.display = "none";
});

/* Handle click on close icon to close modal (mybag_details)*/
$('#detailsitems-close-modal').click(function () {
    document.getElementById("detailsitems-modal").style.display = "none";
});

function set_dom_current_bag_weight(){
    additems_current_bagweight.innerHTML = Math.abs(current_bagweight).toFixed(2) + " kg";
}

function set_modal_dom_elements_items(item, name){
    document.getElementById(name+"-modal").style.display = "block";

    document.getElementById(name+"_item_name").innerHTML = item.name.toUpperCase();
    document.getElementById(name+"_item_category").innerHTML = "Category : " + item.category;
    document.getElementById(name+"_item_weight").innerHTML = "Average Weight (kg) : " + item.weight;
    document.getElementById(name+"_item_usefulness").innerHTML = "Usefulness : " + item.usefulness + " / 10";
    document.getElementById(name+"_item_external").innerHTML =
    "Can be brought externally (out of bag) : " + (item.external ? "Yes" : "No");

    document.getElementById(name+"_item_with_child").innerHTML =
    "Underage company specific : " + (item.with_child == true ? "Yes" : "No");
    document.getElementById(name+"_item_with_elder").innerHTML =
    "Elder company specific : " + (item.with_elder == true ? "Yes" : "No");
    document.getElementById(name+"_item_with_pet").innerHTML =
    "Pet specific : " + (item.with_pet == true ? "Yes" : "No");

    document.getElementById(name+"_item_climates").innerHTML = "Climates which requires this item :<br>";
    append_list_elements(document.getElementById(name+"_item_climates"), item.climate);
    document.getElementById(name+"_item_landforms").innerHTML = "Climates which requires this item :<br>";
    append_list_elements(document.getElementById(name+"_item_landforms"), item.landform);
    document.getElementById(name+"_item_environments").innerHTML = "Climates which requires this item :<br>";
    append_list_elements(document.getElementById(name+"_item_environments"), item.environment);

    document.getElementById(name+"_item_available_infrastructure").innerHTML =
    "Human infrastructure : " + (item.available_infrastructure == false ? "Yes" : "No");
    document.getElementById(name+"_item_available_water").innerHTML =
    "Drinking water : " + (item.available_water == false ? "Yes" : "No");
    document.getElementById(name+"_available_food").innerHTML =
    "Comestibles (food) : " + (item.available_food == false ? "Yes" : "No");
}

function append_list_elements(dom, list){
    for(i=0;i<list.length;i++){
        if(i < list.length - 1){
            dom.innerHTML += list[i].name + ", ";
        } else{
            dom.innerHTML += list[i].name
        }
    }
}